<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Unifying Autoregressive and Diffusion Models for Better Sequence Generation | </title> <meta name="author" content="Nima Fathi"> <meta name="description" content="Exploring our novel framework that unifies autoregressive and diffusion-based sequence generation through hyperschedules and hybrid noising processes."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nimafathi.github.io/blog/2025/unifying-ar-diffusion/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Unifying Autoregressive and Diffusion Models for Better Sequence Generation",
            "description": "Exploring our novel framework that unifies autoregressive and diffusion-based sequence generation through hyperschedules and hybrid noising processes.",
            "published": "April 07, 2025",
            "authors": [
              
              {
                "author": "Nima Fathi",
                "authorURL": "https://nimafathi.github.io",
                "affiliations": [
                  {
                    "name": "ServiceNow, Montreal",
                    "url": "https://www.servicenow.com"
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Unifying Autoregressive and Diffusion Models for Better Sequence Generation</h1> <p>Exploring our novel framework that unifies autoregressive and diffusion-based sequence generation through hyperschedules and hybrid noising processes.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#introduction">Introduction</a></div> <div><a href="#background">Background</a></div> <div><a href="#hyperschedules">Hyperschedules</a></div> <div><a href="#hybrid-noising">Hybrid Noising Processes</a></div> <div><a href="#adaptive-correction">Adaptive Correction Sampler (ACS)</a></div> <div><a href="#results">Experimental Results</a></div> <div><a href="#efficiency">Efficiency via Attention Masks</a></div> <div><a href="#conclusion">Conclusion and Future Work</a></div> </nav> </d-contents> <h2 id="introduction">Introduction</h2> <p>Imagine combining the efficiency of <strong>autoregressive (AR) models</strong>—like GPT—which generate sequences token by token—with the robustness of <strong>diffusion models</strong>, renowned for their iterative refinement and error correction. At the DeLTa Workshop (ICLR 2025), we presented a unified framework that brings these two approaches together. This post dives deeply into our methods and results, detailing how hyperschedules, hybrid noising, and adaptive correction yield significant improvements in sequence generation.</p> <h2 id="background">Background</h2> <p>AR models generate sequences one token at a time, predicting each token based on its predecessors. While this method is computationally efficient, errors cannot be revised once generated. Diffusion models, by contrast, generate sequences by gradually refining random noise, which allows for iterative corrections but is typically slower and more computationally expensive. Notably, AR models can be considered a special case of diffusion models with an extreme noising schedule—this insight paves the way for our unification.</p> <h2 id="hyperschedules">Hyperschedules</h2> <p>To bridge AR and diffusion models, we introduce <strong>hyperschedules</strong>—custom noise schedules assigned to individual token positions. Traditional diffusion models apply noise uniformly across tokens; hyperschedules allow us to vary the noise level per token, creating a smooth continuum between strict autoregression and full diffusion.</p> <figure> <img src="/assets/img/unifying_ar_diff/hyperschedules.png" alt="Hyperschedule Examples"> <figcaption>Figure 1: Examples of hyperschedules: Quenched AR, Flat, Block, Slide Annealing.</figcaption> </figure> <p>This flexibility enables our models to generate sequences either token-by-token (as in AR) or iteratively (as in diffusion), or even intermediate hybrid modes.</p> <h2 id="hybrid-noising-processes">Hybrid Noising Processes</h2> <p>Diffusion models often rely on two noising schemes:</p> <ul> <li> <strong>Absorbing process</strong>: where tokens are replaced with a special MASK token.</li> <li> <strong>Uniform process</strong>: where tokens are substituted randomly.</li> </ul> <p>Our <strong>hybrid noising process</strong> blends these two methods, introducing controlled errors (illustrated in red) while masking other tokens. This train-the-model-to-correct strategy facilitates robust sequence generation even when initial predictions are uncertain.</p> <figure> <img src="/assets/img/unifying_ar_diff/hybrid_noising.png" alt="Hybrid Noising Illustration"> <figcaption>Figure 2: Hybrid noising introduces controlled errors (red tokens), guiding the model to learn corrections during generation.</figcaption> </figure> <p>We explore two variants:</p> <ul> <li> <strong>γ-Hybrid</strong>: employing an analytical approach based on SEDD.</li> <li> <strong>ε-Hybrid</strong>: using a more straightforward weighted cross-entropy formulation as seen in MDM frameworks.</li> </ul> <h2 id="adaptive-correction-sampler-acs">Adaptive Correction Sampler (ACS)</h2> <p>Building on hybrid noising, the <strong>Adaptive Correction Sampler (ACS)</strong> is our novel inference algorithm that allows the model to revisit and revise previous token decisions. Unlike traditional AR models—which do not modify past outputs—ACS adaptively corrects errors based on model confidence, reducing cumulative generation errors and yielding higher-quality sequences.</p> <h2 id="experimental-results">Experimental Results</h2> <p>Our unified models were evaluated on several benchmarks, outperforming prior diffusion-based methods and established autoregressive baselines. Below is a performance comparison:</p> <figure> <table> <thead> <tr> <th>Method</th> <th>WikiText</th> <th>Lambada</th> <th>Pubmed</th> <th>Arxiv</th> </tr> </thead> <tbody> <tr> <td>Transformer (Sahoo et al.)</td> <td>25.8</td> <td>51.3</td> <td>49.0</td> <td>41.7</td> </tr> <tr> <td>SEDD (Lou et al.)</td> <td>36.0</td> <td>48.9</td> <td>45.4</td> <td>40.0</td> </tr> <tr> <td>MDLM (Sahoo et al.)</td> <td>33.2</td> <td>48.3</td> <td>43.1</td> <td>37.9</td> </tr> <tr> <td>BD3-LM (Arriola et al.)</td> <td>31.3</td> <td>50.0</td> <td>42.5</td> <td>39.2</td> </tr> <tr> <td><strong>γ-Hybrid (Ours)</strong></td> <td>30.0</td> <td><strong>45.4</strong></td> <td>46.6</td> <td>40.6</td> </tr> <tr> <td><strong>ε-Hybrid (Ours)</strong></td> <td>32.5</td> <td>50.2</td> <td><strong>41.2</strong></td> <td><strong>37.8</strong></td> </tr> </tbody> </table> <figcaption>Table 1: Performance comparison across benchmarks. Bold indicates best performance.</figcaption> </figure> <p>We further investigate the trade-off between sequence generation quality and diversity by analyzing generative perplexity against token-level entropy and MAUVE scores, as visualized in the following figure:</p> <figure> <img src="/assets/img/unifying_ar_diff/perplexity_mauve.png" alt="Quality-Diversity Trade-offs"> <figcaption>Figure 3: Hybrid models achieve better quality-diversity trade-offs compared to baseline diffusion models.</figcaption> </figure> <p>Our hybrid configurations consistently achieve superior positions on both Pareto frontiers, indicating enhanced generation fluency, coherence, and diversity compared to baselines. The observed balance in generation quality and diversity establish a new state-of-the-art in diffusion-based sequence generation.</p> <h2 id="efficiency-via-attention-masks">Efficiency via Attention Masks</h2> <p>Efficiency is paramount for real-world deployment, and our approach facilitates this through advanced attention mechanisms. Our hyperschedules support <strong>KV-caching-compatible attention masks</strong>, which allow us to:</p> <ul> <li> <strong>Reuse settled tokens</strong> (already generated and fixed) via KV-caching.</li> <li> <strong>Focus computations on active tokens</strong> (currently being updated).</li> </ul> <p>Our framework is flexible—it supports both unmasking the MASK token (typical in masked language models) and predicting the next token (autoregressive style), echoing the strategies proposed in DiffuLLaMA. This dual capability enables the model to operate in diverse inference modes depending on the task.</p> <figure> <img src="/assets/img/unifying_ar_diff/transformer_aligned.jpg" alt="Attention Mask: Aligned Configuration" style="max-width:45%;"> <figcaption>Figure 4: Transformer-based sequence generator with an <strong>ALIGNED</strong> attention configuration, akin to masked language models.</figcaption> </figure> <figure> <img src="/assets/img/unifying_ar_diff/transformer_shifted.jpg" alt="Attention Mask: Shifted Configuration" style="max-width:45%;"> <figcaption>Figure 5: Transformer-based sequence generator in a <strong>SHIFTED</strong> configuration, resembling autoregressive models.</figcaption> </figure> <figure> <img src="/assets/img/unifying_ar_diff/attention_mask.jpg" alt="Training Attention Mask"> <figcaption>Figure 6: Example training attention mask for efficient token updates under both aligned and shifted configurations, highlighting the split between settled and active tokens.</figcaption> </figure> <p>From Appendix B, our models partition tokens into three components during generation:</p> <ol> <li> <strong>Settled tokens</strong>: Finalized outputs that can be cached.</li> <li> <strong>Active tokens</strong>: Those being actively updated.</li> <li> <strong>Worthless tokens</strong>: Tokens not yet generated or not relevant to the current context.</li> </ol> <p>This tailored attention mechanism reduces the effective computational load, thereby enhancing inference speed without sacrificing generation quality.</p> <h2 id="conclusion-and-future-work">Conclusion and Future Work</h2> <p>By unifying autoregressive and diffusion models through the innovations of hyperschedules, hybrid noising, and the Adaptive Correction Sampler, we achieve significant improvements in both sequence quality and efficiency. Our model is flexible enough to support multiple inference modes—whether unmasking tokens or predicting future tokens—making it highly adaptable to varied applications.</p> <p>Future research directions include:</p> <ul> <li>Exploring a broader range of hyperschedule designs.</li> <li>Extending the hybrid noising approach to new domains such as code generation.</li> <li>Deepening theoretical understanding of noise scheduling and its impact on model performance.</li> </ul> <p>For further details, please refer to our full paper on <a href="https://arxiv.org/html/2504.06416v1" rel="external nofollow noopener" target="_blank">arXiv</a>.</p> <p>Stay tuned for more updates as we continue to push the boundaries of sequence generation!</p> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Nima Fathi. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>